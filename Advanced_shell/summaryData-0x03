#!/bin/bash
# Script to create a CSV report and calculate averages (with sed)

REPORT_FILE="report.csv"

# Write CSV header
echo "Name,Height (dm),Weight (hg)" > "$REPORT_FILE"

# Loop through all .json files
for file in *.json; do
  # Extract CSV line, then use sed to remove double quotes
  jq -r '[.name, .height, .weight] | @csv' "$file" | sed 's/"//g' >> "$REPORT_FILE"
done

echo "âœ… Report generated: $REPORT_FILE"
echo

# Use sed to clean quotes again before awk processing (defensive)
sed '1d; s/"//g' "$REPORT_FILE" | awk -F, '
{
  height += $2
  weight += $3
  count++
}
END {
  if (count > 0) {
    printf "Average Height: %.2f dm\n", height / count
    printf "Average Weight: %.2f hg\n", weight / count
  } else {
    print "No data available to calculate averages."
  }
}
'
