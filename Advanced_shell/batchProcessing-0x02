#!/bin/bash
# Script to fetch Pokémon data with retry logic and error handling

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

API_URL="https://pokeapi.co/api/v2/pokemon"
DELAY=1.5
MAX_RETRIES=3

for NAME in "${POKEMONS[@]}"; do
  echo "📦 Fetching data for $NAME..."
  
  success=false
  attempt=1

  while [ $attempt -le $MAX_RETRIES ]; do
    response=$(curl -s -f "$API_URL/$NAME")

    if [ $? -eq 0 ]; then
      echo "$response" > "${NAME}.json"
      echo "✅ Successfully saved ${NAME}.json"
      success=true
      break
    else
      echo "⚠️ Attempt $attempt failed for $NAME."
      sleep $DELAY
      attempt=$((attempt + 1))
    fi
  done

  if ! $success; then
    echo "❌ Failed to fetch data for $NAME after $MAX_RETRIES attempts on $(date)" >> errors.txt
    echo "Logged error for $NAME."
  fi

  sleep $DELAY
done
