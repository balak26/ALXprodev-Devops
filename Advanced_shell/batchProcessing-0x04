#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"

declare -A pids

fetch_pokemon() {
  local NAME=$1
  echo "🔄 Fetching $NAME..."
  RESPONSE=$(curl -s -f "$API_URL/$NAME")
  if [ $? -eq 0 ]; then
    echo "$RESPONSE" > "${NAME}.json"
    echo "✅ $NAME saved."
  else
    echo "❌ Failed to fetch $NAME on $(date)" >> errors.txt
  fi
}

for NAME in "${POKEMONS[@]}"; do
  fetch_pokemon "$NAME" &
  pids[$NAME]=$!
done

# Monitor processes and kill if they run > 10 seconds
for NAME in "${!pids[@]}"; do
  PID=${pids[$NAME]}
  ( sleep 10 && kill -9 $PID 2>/dev/null && echo "⏰ $NAME fetch killed due to timeout." ) &
done

wait
echo "🎉 All Pokémon data fetched."
